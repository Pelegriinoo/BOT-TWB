window.TWBSystem = class TWBSystem {
constructor() {
this.isInitialized = false;
this.api = null;
this.auth = null;
this.troops = null;
this.attack = null;
this.interface = null;
}
async init() {
if (this.isInitialized) return;
try {
console.log('🎮 TWB: Inicializando sistema...');
if (!this.isGameReady()) {
console.log('⏳ TWB: Aguardando game_data...');
setTimeout(() => this.init(), 1000);
return;
}
this.api = new window.TribalWarsAPI();
this.auth = new window.AuthManager(this.api);
this.troops = new window.TroopsManager(this.api);
this.attack = new window.AttackSystem(this.api, this.auth, this.troops);
this.interface = new window.TWBInterface(this.api, this.auth, this.troops, this.attack);
await this.interface.init();
this.isInitialized = true;
console.log('✅ TWB: Sistema inicializado com sucesso!');
} catch (error) {
console.error('💥 TWB: Erro na inicialização:', error);
}
}
isGameReady() {
return typeof window.game_data !== 'undefined' && 
window.game_data && 
window.game_data.village && 
document.querySelector('#content_value');
}
};